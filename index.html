const ACCESS_KEY = "секретный_ключ_который_НЕ_в json"; // В идеале — получать из защищённого места (например, ввод пользователя)

fetch("trailers.json")
  .then(r => r.json())
  .then(files => {
    const container = document.getElementById("list");
    container.innerHTML = "";
    files.forEach(filename => {
      const url = `https://trailer.lostplay.workers.dev/${filename}`;
      const a = document.createElement("a");
      a.textContent = filename.replace(/\.mp4$/i, "");
      a.href = url;
      a.target = "_blank";
      // Чтобы ключ не в URL, а в заголовках — можно ловить клик и открывать через fetch+blob, но проще:
      // Делать запрос через fetch с ключом, получать Blob и создавать ObjectURL
      a.addEventListener("click", async e => {
        e.preventDefault();
        try {
          const res = await fetch(url, {
            headers: { "X-Access-Key": ACCESS_KEY }
          });
          if (!res.ok) throw new Error("Доступ запрещён");
          const blob = await res.blob();
          const blobUrl = URL.createObjectURL(blob);
          window.open(blobUrl, "_blank");
        } catch {
          alert("Ошибка доступа или загрузки");
        }
      });
      container.appendChild(a);
    });
  })
  .catch(() => {
    document.getElementById("list").textContent = "Ошибка загрузки списка.";
  });
